{% extends "base.html" %}

{% block title %}
  {% if filters.query or filters.ingredients %}Filtered recipes{% else %}Recipe Repository{% endif %}
{% endblock %}

{% block content %}
  <div class="recipe-layout" data-role="search-layout">
    <aside class="filter-panel">
      <div class="filter-panel__inner">
        <a class="filter-panel__brand" href="{{ url_for('recipes.index') }}">
          <img
            class="filter-panel__logo"
            src="{{ url_for('static', filename='images/logo.png') }}"
            alt="Recipe Repository"
          >
          <span>Recipe Repository</span>
        </a>
        <form
          id="filter-form"
          class="filter-form"
          action="{{ url_for('recipes.index') }}"
          method="get"
          data-endpoint="{{ url_for('recipes.api_recipes') }}"
        >
          <input type="hidden" name="page" value="{{ results.page }}">
          <div class="filter-search">
            <label for="filter-query">Search recipes</label>
            <input
              id="filter-query"
              name="q"
              type="search"
              placeholder="Search recipes..."
              value="{{ filters.query or '' }}"
            >
          </div>
          <details class="filter-section" open>
            <summary>Ingredients</summary>
            <div class="filter-section-body">
              <label for="ingredient-field">Must include</label>
              <div class="ingredient-input" data-role="ingredient-input">
                <ul class="ingredient-chips" data-role="ingredient-chips">
                  {% for ingredient in filters.ingredients %}
                    <li class="chip" data-value="{{ ingredient }}">
                      <span>{{ ingredient }}</span>
                      <button type="button" class="chip-remove" aria-label="Remove ingredient {{ ingredient }}">&times;</button>
                      <input type="hidden" name="ingredient" value="{{ ingredient }}">
                    </li>
                  {% endfor %}
                </ul>
                <input
                  id="ingredient-field"
                  class="ingredient-field"
                  type="text"
                  placeholder="Add ingredient..."
                  data-role="ingredient-field"
                  autocomplete="off"
                >
                <p class="hint">Press Enter to add an ingredient filter.</p>
              </div>
            </div>
          </details>
          <details class="filter-section" open>
            <summary>Cuisine</summary>
            <div class="filter-section-body">
              <fieldset class="filter-group">
                <legend class="sr-only">Cuisine filters</legend>
                {% for option in cuisine_options %}
                  <label class="filter-checkbox">
                    <input
                      type="checkbox"
                      name="cuisine"
                      value="{{ option.value }}"
                      {% if option.value in filters.cuisines %}checked{% endif %}
                      data-auto-submit="change"
                    >
                    <span>{{ option.label }}</span>
                  </label>
                {% endfor %}
              </fieldset>
            </div>
          </details>
          <details class="filter-section" open>
            <summary>Meal</summary>
            <div class="filter-section-body">
              <fieldset class="filter-group">
                <legend class="sr-only">Meal filters</legend>
                {% for option in meal_options %}
                  <label class="filter-checkbox">
                    <input
                      type="checkbox"
                      name="meal"
                      value="{{ option.value }}"
                      {% if option.value in filters.meals %}checked{% endif %}
                      data-auto-submit="change"
                    >
                    <span>{{ option.label }}</span>
                  </label>
                {% endfor %}
              </fieldset>
            </div>
          </details>
          <details class="filter-section" open>
            <summary>Diet</summary>
            <div class="filter-section-body">
              <fieldset class="filter-group">
                <legend class="sr-only">Diet filters</legend>
                {% for option in diet_options %}
                  <label class="filter-checkbox">
                    <input
                      type="checkbox"
                      name="diet"
                      value="{{ option.value }}"
                      {% if option.value in filters.diets %}checked{% endif %}
                      data-auto-submit="change"
                    >
                    <span>{{ option.label }}</span>
                  </label>
                {% endfor %}
              </fieldset>
            </div>
          </details>
          <div class="filter-actions">
            <button type="submit" class="filter-apply">Apply filters</button>
            <button type="button" class="filter-clear" data-role="clear-filters">Clear all</button>
          </div>
        </form>
      </div>
    </aside>
    <section class="results-panel">
      <header class="results-header">
        <h1 data-role="results-title">{{ heading }}</h1>
        <p data-role="results-count">{{ subtitle }}</p>
      </header>
      <div data-role="results-container">
        {% include "recipes/_results.html" %}
      </div>
    </section>
  </div>
{% endblock %}

{% block scripts %}
  {{ super() }}
  <script src="{{ url_for('static', filename='js/search.js') }}" defer></script>
{% endblock %}

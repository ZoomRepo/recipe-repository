{% extends "base.html" %}

{% block title %}
  Source hotlink settings Â· Recipe Repository
{% endblock %}

{% block content %}
  <section class="source-settings">
    <h1>Source hotlink settings</h1>
    <p class="lead">
      Enable hotlinking for partner sources to send visitors directly to the recipe on the original site.
      When hotlinking is enabled for a source, recipe detail pages will redirect to the source and bypass on-site rendering.
    </p>
    {% if preferences %}
      <div class="table-responsive">
        <table class="source-table">
          <thead>
            <tr>
              <th scope="col">Source name</th>
              <th scope="col">Recipes</th>
              <th scope="col">Sample link</th>
              <th scope="col">Hotlink</th>
            </tr>
          </thead>
          <tbody>
            {% for preference in preferences %}
              <tr>
                <td data-label="Source name">{{ preference.source_name }}</td>
                <td data-label="Recipes">{{ preference.recipe_count }}</td>
                <td data-label="Sample link">
                  {% if preference.sample_url %}
                    <a href="{{ preference.sample_url }}" target="_blank" rel="noopener">Open</a>
                  {% else %}
                    <span class="muted">Not available</span>
                  {% endif %}
                </td>
                <td data-label="Hotlink">
                  <form method="post" action="{{ url_for('recipes.update_hotlink', source_name=preference.source_name) }}">
                    <input type="hidden" name="enabled" value="0">
                    <label class="hotlink-toggle">
                      <input
                        type="checkbox"
                        name="enabled"
                        value="1"
                        {% if preference.hotlink_enabled %}checked{% endif %}
                        onchange="this.form.submit()"
                        aria-label="Toggle hotlink for {{ preference.source_name }}"
                      >
                      <span>{% if preference.hotlink_enabled %}Enabled{% else %}Disabled{% endif %}</span>
                    </label>
                  </form>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <p class="muted">No sources found.</p>
    {% endif %}
  </section>
{% endblock %}

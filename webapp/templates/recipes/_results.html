{% if results.items %}
  <ul class="recipe-list">
    {% for recipe in results.items %}
      {% set nutrient_labels = {
        'calories': ('Calories', 'kcal'),
        'protein': ('Protein', 'g'),
        'carbohydrates': ('Carbohydrates', 'g'),
        'fat': ('Fat', 'g'),
        'fiber': ('Fiber', 'g'),
        'sugar': ('Sugar', 'g'),
      } %}
      {% set nutrient_order = ['calories', 'protein', 'carbohydrates', 'fat', 'fiber', 'sugar'] %}
      <li class="recipe-card{% if recipe.image %} recipe-card--with-image{% endif %}" tabindex="0">
        <div class="recipe-card-overlay">
          <div class="recipe-card-overlay__content">
            <div class="recipe-card-overlay__sections">
              <section class="recipe-overlay-section">
                <h3 class="recipe-overlay-heading">Nutrition</h3>
                {% set nutrient_data = recipe.nutrients or {} %}
                {% set has_nutrients = nutrient_data|length > 0 %}
                {% if has_nutrients %}
                  <dl class="recipe-nutrient-list">
                    {% for key in nutrient_order %}
                      {% set value = nutrient_data.get(key) %}
                      {% if value is not none %}
                        <div class="recipe-nutrient">
                          <dt class="recipe-nutrient-label">{{ nutrient_labels[key][0] }}</dt>
                          <dd class="recipe-nutrient-value">{{ '%.2f'|format(value) }} {{ nutrient_labels[key][1] }}</dd>
                        </div>
                      {% endif %}
                    {% endfor %}
                  </dl>
                {% else %}
                  <p class="recipe-overlay-empty">Nutrition information unavailable.</p>
                {% endif %}
              </section>
              <section class="recipe-overlay-section">
                <h3 class="recipe-overlay-heading">Ingredients</h3>
                {% if recipe.ingredients %}
                  <ul class="recipe-ingredient-list">
                    {% for ingredient in recipe.ingredients %}
                      <li>{{ ingredient }}</li>
                    {% endfor %}
                  </ul>
                {% else %}
                  <p class="recipe-overlay-empty">Ingredients unavailable.</p>
                {% endif %}
              </section>
            </div>
          </div>
        </div>
        {% if recipe.image %}
          <a class="recipe-thumb" href="{{ url_for('recipes.detail', recipe_id=recipe.id) }}">
            <img src="{{ recipe.image }}" loading="lazy" alt="Image for {{ recipe.title or 'recipe' }}">
          </a>
        {% endif %}
        <div class="recipe-card-body">
          <h2>
            <a href="{{ url_for('recipes.detail', recipe_id=recipe.id) }}">{{ recipe.title or 'Untitled recipe' }}</a>
          </h2>
          {% if recipe.description %}
            <p class="recipe-summary">{{ recipe.description }}</p>
          {% endif %}
          <p class="recipe-meta">From <a href="{{ recipe.source_url }}" target="_blank" rel="noopener">{{ recipe.source_name }}</a></p>
          {% if recipe.updated_at %}
            <p class="recipe-meta">Updated {{ recipe.updated_at.strftime('%Y-%m-%d %H:%M') }}</p>
          {% endif %}
        </div>
      </li>
    {% endfor %}
  </ul>

  {% if results.total_pages > 1 %}
    <nav class="pagination" aria-label="Search results pages">
      <ul>
        {% for page_number in results.iter_pages() %}
          <li class="pagination-item {% if page_number == results.page %}active{% endif %}">
            <a
              {% if page_number == results.page %}aria-current="page"{% endif %}
              href="{{ url_for(
                'recipes.index',
                page=page_number,
                q=filters.query,
                ingredient=filters.ingredients if filters.ingredients else None,
                cuisine=filters.cuisines if filters.cuisines else None,
                meal=filters.meals if filters.meals else None,
                diet=filters.diets if filters.diets else None,
              ) }}"
              data-page="{{ page_number }}"
            >
              {{ page_number }}
            </a>
          </li>
        {% endfor %}
      </ul>
    </nav>
  {% endif %}
{% else %}
  <p class="empty-state">No recipes found. Try adjusting your filters.</p>
{% endif %}
